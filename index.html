<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NameGen</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="jQueryUI/jquery-ui.min.css" rel="stylesheet" />
    <style>
        
    </style>
    <script src="Scripts/jquery-1.9.1.min.js"></script>
    <script src="jQueryUI/jquery-ui.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="words.js"></script>
<!--<script type="text/javascript" src="nameGen.js"></script>-->

    <script>
        $(function () {
            var $generatorRuleContainer = $("#generatorRuleContainer");
            var $wordListContainer = $("#wordListContainer");

            $generatorRuleContainer.sortable({
               placeholder: "btn",
               forcePlaceholderSize: true,
                cancel: "span.remove-rule-button",
                helper: "clone",
                revert: 42
            });
            $generatorRuleContainer.disableSelection();
            $(".wordList", $wordListContainer).disableSelection();

           

      
			
            

            $(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
            ExecuteLeft();
        break;

        case 38: // up
            ExecuteUp();
        break;

        case 39: // right
            ExecuteRight();
        break;

        case 40: // down
            ExecuteDown();
        break;

        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
            });

            //AddWordList("local_test2", "Local Test 2", ["a", "b", "c"]);
            //StoreLocalWordListList();
            //StoreLocalWordList("test2");

            AddBuiltInWordLists();
            AddUserWordLists();
            MakeWordListItemsDragable();

            // add a few rules before we get started
            amount = Random(2, 5);
            for (i = 0; i < amount; i++) {
                $oneChild = RandomListEntry($wordListContainer.children());
                AddRuleToContainer($($oneChild).clone());
            }

            // and generate our very first sequence! yay!
            GenerateWordSequence();

            
        });

        var prefixLocal = "local_";
        var wordLists = {};
        var wordListList = {};

        function AddBuiltInWordLists () {
            for (var key in builtInWordLists) {
                if (builtInWordLists.hasOwnProperty(key)) {
                    var newKey = "builtIn_" + key;
                    AddWordList(newKey, key, ParseWordListBlob(builtInWordLists[key])); 
                }
            }
        }

        function AddUserWordLists() {
            // we kinda need local storage for this function
            if (!SupportsHtml5Storage())
                return;

            // get list of stored lists
            wordListList = LoadLocalWordListList();
            if (wordListList == null)
                return;
            
            for (var listID in wordListList) {
                if (wordListList.hasOwnProperty(listID)) {
                    wordList = LoadLocalWordList(listID);
                    if (wordList != null
                        && wordList.length > 0) {
                        var newKey = prefixLocal + listID;
                        AddWordList(newKey, wordListList[listID], wordList);
                    }
                }
            }
        }

        function AddWordList(key, title, content) {
            if (wordLists[key] != null)
                return;
            addWordListToOverview(key, title);
            wordLists[key] = content;
            wordListList[key] = title;
        }

        function LoadLocalWordList(listID) {
            localWordListBlob = localStorage["wordList_" + listID];
            if (localWordListBlob == null)
                return null;
            return ParseWordListBlob(localWordListBlob);
        }

        function StoreLocalWordList(listID) {
            localWordListBlob = "";
            content = wordLists[prefixLocal + listID];
            for (var i = 0; i < content.length; i++) {
                localWordListBlob += content[i] + " ";
            }
            if (localWordListBlob != "") {
                localStorage["wordList_" + listID] = localWordListBlob;
            }
        }

        function LoadLocalWordListList() {
            wordListListString = localStorage["wordListList"];
            if (wordListListString == null)
                return null;
            return ParseWordListListBlob(wordListListString);
        }

        function StoreLocalWordListList() {
            wordListListTuples = "";
            for (var key in wordListList) {
                if (wordListList.hasOwnProperty(key)) {
                    if (key.substr(0, prefixLocal.length) == prefixLocal) {
                        actualKey = key.substr(prefixLocal.length);
                        wordListListTuples += actualKey + "," + wordListList[key] + ";";
                    }
                }
            }
            localStorage["wordListList"] = wordListListTuples;
        }

        function ParseWordListBlob(wordListBlob) {
            wordListBlob = wordListBlob.trim();
            return wordListBlob.split(" ");
        }

        function ParseWordListListBlob(wordListListBlob) {
            wordListListTuples = wordListListBlob.split(";");
            result = {};
            for (var i = 0; i < wordListListTuples.length; i++) {
                wordListListTupleSplit = wordListListTuples[i].split(",");
                result[wordListListTupleSplit[0]] = wordListListTupleSplit[1];
            }
            return result;
        }

        function RandomDictionaryKey(dictionary) {
            return RandomListEntry(GetDictionaryKeys(dictionary));
        }

        function GetDictionaryKeys(dictionary) {
            return $.map(dictionary, function (v, i) {
                return i;
            });
        }

        function RandomListEntry(list) {
            return list[Random(0, list.length)];
        }

        function Random(min, max) {
            var range = max - min;
            return Math.floor(Math.random() * range) + min;
        }

        function FetchGeneratorRule() {
            rule = $("#generatorRuleContainer").children().map(function () { return $(this).attr("alt") });
            
            return rule;
        }

        function GenerateWordSequence() {
            result = "";
            rule = FetchGeneratorRule();
            for (i = 0; i < rule.length; i++) {
                ruleAtom = rule[i];
                result += RandomListEntry(wordLists[ruleAtom]) + " ";
            }
            $("#result").text(result);
        }

        function ExecuteRight () {
            GenerateWordSequence();
        }

        function ExecuteLeft() {

        }

        function ExecuteDown() {
            StoreCurrentWords();
            ExecuteRight();
        }

        function ExecuteUp() {
        }

        var listContainerItem = "<div class='btn wordList'></div>";
        var listContainerItemButton = "<span class='glyphicon glyphicon-pencil edit-list-button' aria-hidden='true'></span>";

        var resultContainerItem = "<div class='btn'></div>";

        function addWordListToOverview(key, title) {
            $newItem = CreateWordListItem(key, title);

            $("#wordListContainer").append($newItem);
        }

        function StoreCurrentWords() {
            AddWordsToResultContainer($("#result").text());
        }

        function AddWordsToResultContainer (words) {
            $("#resultContainer").append(CreateResultListItem(words));
        }

        function CreateResultListItem(words) {
            $newItem = $(resultContainerItem);
            $newItem.text(words);
            return $newItem;
        }

        function CreateWordListItem(key, title) {
            $newItem = $(listContainerItem);
            $newItem.text(title);
            $newItem.attr("alt", key);
            $newItem.append(listContainerItemButton);

            $(".edit-list-button").click(function () {
                alert($(this).parent().attr("alt"));
            });

            return $newItem;
        }

        function AddRuleToContainer(wordListItem) {
            $itemForRuleContainer = addToRuleContainer(wordListItem);
            $("#generatorRuleContainer").append($itemForRuleContainer);
        }

        //var ruleContainerItem = "<div class='btn'></div>";
        var ruleContainerItemButton = "<span class='glyphicon glyphicon-remove remove-rule-button' aria-hidden='true'></span>";
        function addToRuleContainer($item) {
            $(".edit-list-button", $item).remove();
            $item.append(ruleContainerItemButton);
            $(".remove-rule-button").click(function () {
                $(this).parent().remove();
            });
            return $item;
        }

        function MakeWordListItemsDragable() {
            var $wordListContainer = $("#wordListContainer");

            $(".wordList", $wordListContainer).draggable({
                cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: true, // when not dropped, the item will revert back to its initial position
                revertDuration: 10,
                containment: "document",
                helper: "clone",
                cursor: "move",
                start: function (event, ui) {
                    addToRuleContainer(ui.helper);
                },
                connectToSortable: "#generatorRuleContainer"
            });
        }


        function SupportsHtml5Storage() {
            try {
                return 'localStorage' in window && window['localStorage'] !== null;
            } catch (e) {
                return false;
            }
        }
       
    </script>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1 id="result"></h1>

                <button class="btn btn-success btn-lg" onclick="ExecuteLeft();">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    Last
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                </button>
                <button class="btn btn-success btn-lg" onclick="ExecuteDown();">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    Keep
                    <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                </button>
                <button class="btn btn-danger btn-lg" onclick="ExecuteRight();">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    Next
                    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
                </button>

        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Generator Rule</div>
            <div class="panel-body">
                <div class="row well" id="generatorRuleContainer">
                </div>
            </div>
        </div>
        
        <div class="row panel" id="wordListContainer">
            
        </div>
        <div class="row panel" id="resultContainer">

        </div>
       
    </div>

    <footer class="modal-footer" role="contentinfo">
        <div class="container">
            <a href="http://samwalz.com/">samwalz.com</a>
        </div>
    </footer>



</body>


</html>