<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NameGen</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet" />
    <link href="jQueryUI/jquery-ui.min.css" rel="stylesheet" />
    <style>
        
    </style>
    <script src="Scripts/jquery-1.9.1.min.js"></script>
    <script src="jQueryUI/jquery-ui.min.js"></script>
    <script src="jQueryUI/jquery.ui.touch-punch.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
<script type="text/javascript" src="words.js"></script>
<!--<script type="text/javascript" src="nameGen.js"></script>-->

    <script>
        $(function () {
            var prefixLocal = "local_";
            var wordLists = {};
            var wordListList = {};

            var $generatorRuleContainer = $("#generatorRuleContainer");
            var $wordListContainer = $("#wordListContainer");

            $generatorRuleContainer.sortable({
               placeholder: "btn",
               forcePlaceholderSize: true,
                cancel: "span.remove-rule-button",
                helper: "clone",
                revert: 42
            });
            $generatorRuleContainer.disableSelection();
            $(".wordList", $wordListContainer).disableSelection();

           

      
			
            

            $(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
            ExecuteLeft();
        break;

        case 38: // up
            ExecuteUp();
        break;

        case 39: // right
            ExecuteRight();
        break;

        case 40: // down
            ExecuteDown();
        break;

        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
            });

            //AddWordList("local_test2", "Local Test 2", ["a", "b", "c"]);
            
            LoadSettings();

            AddUserWordLists();
            AddBuiltInWordLists();
            MakeWordListItemsDragable();

            // add a few rules before we get started
            amount = Random(2, 5);
            for (i = 0; i < amount; i++) {
                $oneChild = RandomListEntry($wordListContainer.children());
                AddRuleToContainer($($oneChild).clone());
            }

            // and generate our very first sequence! yay!
            GenerateWordSequence();

            //switch to normal mode
            WordListContainerMode();
            
        });

        


        function AddBuiltInWordLists () {
            for (var key in builtInWordLists) {
                if (builtInWordLists.hasOwnProperty(key)) {
                    var newKey = "builtIn_" + key;
                    AddWordList(newKey, key, ParseWordListBlob(builtInWordLists[key])); 
                }
            }
        }

        function AddUserWordLists() {
            // we kinda need local storage for this function
            if (!SupportsHtml5Storage())
                return;

            // get list of stored lists
            wordListList = LoadLocalWordListList();
            if (wordListList == null)
                return;
            
            for (var listID in wordListList) {
                if (wordListList.hasOwnProperty(listID)) {
                    wordList = LoadLocalWordList(listID);
                    if (wordList != null
                        && wordList.length > 0) {
                        var newKey = prefixLocal + listID;
                        AddWordList(newKey, wordListList[listID], wordList);
                    }
                }
            }
        }

        function IsLocalList(key) {
            return key.substr(0, prefixLocal.length) == prefixLocal;
        }

        function ActualKey(key) {
            if (IsLocalList(key))
                return key.substr(prefixLocal.length);
            return key;
        }

        function AddWordList(key, title, content) {
            if (title == "") {
                alert("Word List Title Can Not Be Empty");
                return;
            }

            if (wordLists[key] != null)
                return;
            addWordListToOverview(key, title);
            wordLists[key] = content;
            wordListList[key] = title;

            if (IsLocalList(key)) {
                actualKey = ActualKey(key);
                StoreLocalWordList(actualKey);
                StoreLocalWordListList();
            }
        }

        function UpdateWordList(key, title, content) {
            wordLists[key] = content;
            wordListList[key] = title;
            $("span[alt=" + key + "_title]").text(title);
            //$("#" + key + "_title").text(title);

            actualKey = ActualKey(key);
            StoreLocalWordList(actualKey);
            StoreLocalWordListList();
        }

        function RemoveWordList(key) {
            wordLists[key] = null;
            delete wordListList[key];
            
            $("div[alt=" + key + "]").remove();

            localStorage["wordList_" + key] = null;
            StoreLocalWordListList();
        }

        function LoadLocalWordList(listID) {
            localWordListBlob = localStorage["wordList_" + listID];
            if (localWordListBlob == null)
                return null;
            return ParseWordListBlob(localWordListBlob);
        }

        function StoreLocalWordList(listID) {
            localWordListBlob = "";
            content = wordLists[prefixLocal + listID];
            if (content != null) {
                localWordListBlob = CreateWordListBlob(content);
                if (localWordListBlob != "") {
                    localStorage["wordList_" + listID] = localWordListBlob;
                }
            }
        }

        function LoadLocalWordListList() {
            wordListListString = localStorage["wordListList"];
            if (wordListListString == null)
                return null;
            return ParseWordListListBlob(wordListListString);
        }

        function StoreLocalWordListList() {
            wordListListTuples = "";
            for (var key in wordListList) {
                if (wordListList.hasOwnProperty(key)) {
                    if (IsLocalList(key)) {
                        actualKey = key.substr(prefixLocal.length);
                        if (actualKey != "") {
                            //alert(actualKey);
                            wordListListTuples += actualKey + "," + wordListList[key] + ";";
                        }
                    }
                }
            }
            localStorage["wordListList"] = wordListListTuples;
        }

        function CreateWordListBlob(list) {
            result = "";
            for (var i = 0; i < list.length; i++) {
                result += list[i] + " ";
            }
            return result.trim();
        }

        function ParseWordListBlob(wordListBlob) {
            wordListBlob = wordListBlob.trim();
            return wordListBlob.split(" ");
        }

        function ParseWordListListBlob(wordListListBlob) {
            wordListListTuples = wordListListBlob.split(";");
            result = {};
            for (var i = 0; i < wordListListTuples.length; i++) {
                wordListListTupleSplit = wordListListTuples[i].split(",");
                result[wordListListTupleSplit[0]] = wordListListTupleSplit[1];
            }
            return result;
        }

        function RandomDictionaryKey(dictionary) {
            return RandomListEntry(GetDictionaryKeys(dictionary));
        }

        function GetDictionaryKeys(dictionary) {
            return $.map(dictionary, function (v, i) {
                return i;
            });
        }

        function RandomCharacterCasing(char) {
            if (CoinShowsHead())
                return char.toUpperCase();
            else
                return char.toLowerCase();
        }

        function CoinShowsHead() {
            return Random(0, 2) == 1;
        }

        function RandomListEntry(list) {
            return list[Random(0, list.length)];
        }

        function Random(min, max) {
            var range = max - min;
            return Math.floor(Math.random() * range) + min;
        }

        function FetchGeneratorRule() {
            rule = $("#generatorRuleContainer").children().map(function () { return $(this).attr("alt") });
            
            return rule;
        }

        function GenerateWordSequence() {
            result = "";
            rule = FetchGeneratorRule();
            for (i = 0; i < rule.length; i++) {
                ruleAtom = rule[i];
                result += RandomListEntry(wordLists[ruleAtom]) + " ";
            }
            $("#result").text(TreatWordSequenceWithSettings(result));
        }

        function TreatWordSequenceWithSettings(sequence) {
            result = sequence;
            if (settings.wordCasing == "lower case") {
                result = result.toLowerCase();
            } else if (settings.wordCasing == "UPPER CASE") {
                result = result.toUpperCase();
            } else if (settings.wordCasing == "Camel Case") {
                result = " " + result;
                result = result.replace(/\ \w/gi, function myFunction(x) { return x.toUpperCase(); }).trim();
            } else if (settings.wordCasing == "RanDOm") {
                buffer = result;
                result = "";
                for (var i = 0; i < buffer.length; i++) {
                    result += RandomCharacterCasing(buffer[i]);
                }
            }
            return result;
        }

        function ExecuteRight () {
            GenerateWordSequence();
        }

        function ExecuteLeft() {

        }

        function ExecuteDown() {
            StoreCurrentWords();
            ExecuteRight();
        }

        function ExecuteUp() {
        }

        var listContainerItem = "<div class='btn wordList'></div>";
        var listContainerItemTitle = "<span></span>";
        var listContainerItemButton = "<span class='glyphicon glyphicon-pencil edit-list-button' aria-hidden='true'></span>";

        var resultContainerItem = "<div class='btn'></div>";

        function addWordListToOverview(key, title) {
            $newItem = CreateWordListItem(key, title);

            $("#wordListContainer").append($newItem);
        }

        function StoreCurrentWords() {
            AddWordsToResultContainer($("#result").text());
        }

        function AddWordsToResultContainer (words) {
            $("#resultContainer").append(CreateResultListItem(words));
        }

        function CreateResultListItem(words) {
            $newItem = $(resultContainerItem);
            $newItem.text(words);
            return $newItem;
        }

        function CreateWordListItem(key, title) {
            $newItem = $(listContainerItem);
            //$newItem.text(title);
            $newItem.attr("alt", key);
            //$newItem.attr("id", key);
            $itemTitle = $(listContainerItemTitle);
            $itemTitle.text(title);
            $itemTitle.attr("alt", key + "_title");
            $newItem.append($itemTitle);

            if (IsLocalList(key)) {
                $newItem.append(listContainerItemButton).click(function () {
                    EditWordList(key);
                });
            }

            return $newItem;
        }

        function CreateNewWordListKey() {
            nowDate = new Date();
            return prefixLocal + nowDate.getUTCFullYear() + "_" + nowDate.getUTCMonth() + "_" + nowDate.getUTCDate() + "_" + nowDate.getUTCHours() + "_" + nowDate.getUTCMinutes() + "_" + nowDate.getUTCSeconds() + "_" + nowDate.getUTCMilliseconds();
        }

        function WordListEditMode() {
            $("#wordListMenuBar").collapse("hide");
            $("#wordListContainer").collapse("hide");
            $("#wordListEditor").collapse("show");
        }

        function WordListContainerMode() {
            $("#wordListMenuBar").collapse("show");
            $("#wordListContainer").collapse("show");
            $("#wordListEditor").collapse("hide");
            $("#wordListSettings").collapse("hide");
        }

        function WordListSettingsMode() {
            $("#wordListMenuBar").collapse("hide");
            $("#wordListContainer").collapse("hide");
            $("#wordListSettings").collapse("show");
        }

        function EditWordList(key) {
            WordListEditMode();
            $("#wordListIDField").val(key);
            $("#wordListTitleField").val(wordListList[key]);
            $("#wordListWordsField").val(CreateWordListBlob(wordLists[key]));
        }

        function NewWordList() {
            WordListEditMode();
            $("#wordListIDField").val(CreateNewWordListKey());
            $("#wordListTitleField").val("");
            $("#wordListWordsField").val("");
        }

        function SaveWordList(key) {
            WordListContainerMode();
            wordListID = $("#wordListIDField").val();

            // lets get the title and make sure that it does not contain the two reserved characters
            wordListTitle = $("#wordListTitleField").val();
            wordListTitle = wordListTitle.replace(";", "");
            wordListTitle = wordListTitle.replace(",", "");

            wordListContent = ParseWordListBlob($("#wordListWordsField").val());
            if (wordLists[wordListID] == null) {
                AddWordList(wordListID, wordListTitle, wordListContent);
                MakeWordListItemsDragable();
            } else {
                UpdateWordList(wordListID, wordListTitle, wordListContent);
            }
        }

        function CancelWordList() {
            WordListContainerMode();
            $("#wordListIDField").val("");
            $("#wordListTitleField").val("");
            $("#wordListWordsField").val("");
        }

        function DeleteWordList() {
            WordListContainerMode();
            wordListID = $("#wordListIDField").val();
            wordListTitle = $("#wordListTitleField").val();
            if (!confirm("Do you really want to delete your word list '" + wordListTitle + "' ?\n(Can not be undone!)"))
                return;
            
            RemoveWordList(wordListID);
            $("#wordListIDField").val("");
            $("#wordListTitleField").val("");
            $("#wordListWordsField").val("");
            
        }
        
        var settings = {};

        function LoadSettings() {
            settings.wordCasing = localStorage["settings.wordCasing"];

            $("#settingsWordCasing").text(settings.wordCasing);
        }

        function SaveSettings() {
            WordListContainerMode();
            settings.wordCasing = $("#settingsWordCasing").text();

            localStorage["settings.wordCasing"] = settings.wordCasing;
        }

        function SetTextSettingsWordCasing(value) {
            $("#settingsWordCasing").text(value);
        }

        function AddRuleToContainer(wordListItem) {
            $itemForRuleContainer = addToRuleContainer(wordListItem);
            $("#generatorRuleContainer").append($itemForRuleContainer);
        }

        //var ruleContainerItem = "<div class='btn'></div>";
        var ruleContainerItemButton = "<span class='glyphicon glyphicon-remove remove-rule-button' aria-hidden='true'></span>";
        function addToRuleContainer($item) {
            $(".edit-list-button", $item).remove();
            $item.append(ruleContainerItemButton);
            $(".remove-rule-button").click(function () {
                $(this).parent().remove();
            });
            return $item;
        }

        function MakeWordListItemsDragable() {
            var $wordListContainer = $("#wordListContainer");

            $(".wordList", $wordListContainer).draggable({
                cancel: "a.ui-icon", // clicking an icon won't initiate dragging
                revert: true, // when not dropped, the item will revert back to its initial position
                revertDuration: 10,
                containment: "document",
                helper: "clone",
                cursor: "move",
                start: function (event, ui) {
                    addToRuleContainer(ui.helper);
                },
                connectToSortable: "#generatorRuleContainer"
            });
        }


        function SupportsHtml5Storage() {
            try {
                return 'localStorage' in window && window['localStorage'] !== null;
            } catch (e) {
                return false;
            }
        }
       
    </script>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1 id="result"></h1>

                <!--<button class="btn btn-success btn-lg" onclick="ExecuteLeft();">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    Last
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                </button>-->
                <button class="btn btn-success btn-lg" onclick="ExecuteDown();">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    Keep
                    <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                </button>
                <button class="btn btn-danger btn-lg" onclick="ExecuteRight();">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    Next
                    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
                </button>

        </div>
        <div class="panel panel-default">
            <div class="panel-heading">Generator Rule</div>
            <div class="panel-body">
                <div class="row well" id="generatorRuleContainer">
                </div>
            </div>
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">Word Lists</div>
            <div class="panel-body">
                <div class="panel-collapse row" id="wordListMenuBar">
                    <button class="btn btn-default" onclick="NewWordList();">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                        New Word List
                    </button>
                    <button class="btn btn-default" onclick="LoadSettings();WordListSettingsMode();">
                        <span class='glyphicon glyphicon-pencil' aria-hidden='true'></span>
                        Settings
                    </button>
                </div>
                <div class="panel-collapse collapse row well" id="wordListEditor">
                    <div class="input-group">
                        <span class="input-group-addon" id="titleSpan">Title</span>
                        <input id="wordListTitleField" type="text" class="form-control" placeholder="a meaningful title (no special characters)" aria-describedby="titleSpan">
                        <input id="wordListIDField" type="hidden">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="wordsSpan">Words</span>
                        <textarea id="wordListWordsField" name="message" class="form-control" placeholder="words words words (space separated)" rows="10" cols="30" aria-describedby="wordsSpan"></textarea>
                    </div>
                    <div class="input-group">
                        <button class="btn btn-default" onclick="SaveWordList();">
                            <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                            Save
                        </button>
                        <button class="btn btn-default" onclick="CancelWordList();">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            Cancel
                        </button>
                        <button class="btn btn-default" onclick="DeleteWordList();">
                            <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                            Delete
                        </button>
                    </div>
                </div>
                <div class="panel-collapse collapse row well" id="wordListSettings">
                    <div class="input-group">
                        <span class="input-group-addon" id="Span1">Word Casing</span>
                        <div class="dropdown">
                          <button class="btn btn-default dropdown-toggle" type="button" id="settingsWordCasing_button" data-toggle="dropdown" aria-expanded="true">
                            <span id="settingsWordCasing">Dropdown</span>
                            <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="SetTextSettingsWordCasing('as Defined');">as Defined</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="SetTextSettingsWordCasing('lower case');">lower case</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="SetTextSettingsWordCasing('UPPER CASE');">UPPER CASE</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="SetTextSettingsWordCasing('Camel Case');">Camel Case</a></li>
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="SetTextSettingsWordCasing('RanDOm');">RanDOm</a></li>
                          </ul>
                        </div>
                    </div>
                    <div class="input-group">
                        <button class="btn btn-default" onclick="SaveSettings();">
                            <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>
                            Save
                        </button>
                        <button class="btn btn-default" onclick="WordListContainerMode();">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            Cancel
                        </button>
                    </div>
                </div>
                <div class="panel-collapse row" id="wordListContainer">
                </div>
            </div>
        </div>
        <div class="row panel" id="resultContainer">

        </div>
       
    </div>

    <footer class="modal-footer" role="contentinfo">
        <div class="container">
            <a href="http://samwalz.com/">samwalz.com</a>
        </div>
    </footer>



</body>


</html>
